!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).MedianCut=e()}(this,(function(){"use strict";var t=function(t){this.imageData=t,this.colors=this.__calculateColorCount(this.imageData.data),this.buckets=[]},e={palette:{configurable:!0}};return e.palette.get=function(){for(var t=[],e=0,r=this.buckets.length;e<r;e=e+1|0)t[e]=this.__getAverageColor(this.buckets[e].color);return t},t.prototype.reduce=function(t){if(this.colors.length<=t)return console.warn("It has already been reduced color."),this.imageData;this.buckets=this.__mediancut([this.__generateBucket(this.colors)],t);for(var e=new Map,r=0,o=this.buckets.length;r<o;r=r+1|0)for(var a=this.buckets[r],n=this.__getAverageColor(a.colors),i=0,l=a.colors.length;i<l;i=i+1|0){var c=a.colors[i],s=248&c[0]|(248&c[1])<<8|(248&c[2])<<16;e.set(s,n)}for(var h=this.imageData.data,u=h.length,g=new Uint8ClampedArray(u),f=0;f<u;){var _=248&h[f]|(248&h[f+1])<<8|(248&h[f+2])<<16,p=e.get(_),d=p[0],v=p[1],m=p[2];g[f]=d,g[f+1]=v,g[f+2]=m,g[f+3]=h[f+3],f=f+4|0}return new ImageData(g,this.imageData.width,this.imageData.height)},t.prototype.__calculateColorCount=function(t){for(var e=new Map,r=t.length,o=0;o<r;){var a=248&t[o],n=248&t[o+1],i=248&t[o+2],l=a|n<<8|i<<16,c=e.get(l),s=c?c[3]+1:1;e.set(l,[a,n,i,s]),o=o+4|0}var h=[];return e.forEach((function(t){h[h.length]=t})),h},t.prototype.__getAverageColor=function(t){for(var e=0,r=0,o=0,a=0,n=0,i=t.length;n<i;n=n+1|0){var l=t[n],c=l[0],s=l[1],h=l[2],u=l[3];r=c*u+r,o=s*u+o,a=h*u+a,e=e+u|0}return[Math.round(r/e),Math.round(o/e),Math.round(a/e)]},t.prototype.__getTotalAnGreatestRangeChannel=function(t){for(var e=0,r=0,o=0,a=0,n=255,i=255,l=255,c=t.length,s=0;s<c;){var h=t[s],u=h[0],g=h[1],f=h[2],_=h[3];r=Math.max(u,r),o=Math.max(g,o),a=Math.max(f,a),n=Math.min(u,n),i=Math.min(g,i),l=Math.min(f,l),e+=_,s=s+1|0}var p=1.2*(r-n),d=1.2*(o-i),v=a-l,m=Math.max(p,d,v),M=0;return p===m&&(M=0),d===m&&(M=1),v===m&&(M=2),{total:e,channel:M}},t.prototype.__mediancut=function(t,e){var r=0,o=0;if(t.length+1>e)return t;for(var a=0,n=t.length;a<n;a=a+1|0)t[a].total>r&&1!==t[a].colors.length&&(o=a,r=t[a].total);var i=t[o];if(1===i.total||1===i.colors.length)return console.error("Cube could not be split."),t;var l=i.channel;i.colors.sort((function(t,e){return t[l]-e[l]}));var c=Math.floor((i.colors.length+1)/2),s=this.__generateBucket(i.colors.slice(0,c)),h=this.__generateBucket(i.colors.slice(c));return t.splice(o,1,s,h),this.__mediancut(t,e)},t.prototype.__generateBucket=function(t){var e=this.__getTotalAnGreatestRangeChannel(t);return{colors:t,total:e.total,channel:e.channel}},Object.defineProperties(t.prototype,e),t}));
