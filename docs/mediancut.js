!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MedianCut=e()}(this,(function(){"use strict";var t;!function(t){t[t.R=0]="R",t[t.G=1]="G",t[t.B=2]="B"}(t||(t={}));var e=function(t){this.imageData=t,this.colors=this.__calculateColorCount(this.imageData.data),this.buckets=[]},o={palette:{configurable:!0}};return o.palette.get=function(){for(var t=[],e=0,o=this.buckets.length;e<o;e=e+1|0)t[e]=this.__getAverageColor(this.buckets[e].colors);return t},e.prototype.reduce=function(t){if(this.colors.length<=t)return console.warn("It has already been reduced color."),this.imageData;this.buckets=this.__mediancut([this.__generateBucket(this.colors)],t);for(var e=new Map,o=0,r=this.buckets.length;o<r;o=o+1|0)for(var a=this.buckets[o],n=this.__getAverageColor(a.colors),i=0,l=a.colors.length;i<l;i=i+1|0){var s=a.colors[i],c=248&s[0]|(248&s[1])<<8|(248&s[2])<<16;e.set(c,n)}for(var h=this.imageData.data,u=h.length,g=new Uint8ClampedArray(u),f=0;f<u;){var p=248&h[f]|(248&h[f+1])<<8|(248&h[f+2])<<16,_=e.get(p),d=_[0],v=_[1],m=_[2];g[f]=d,g[f+1]=v,g[f+2]=m,g[f+3]=h[f+3],f=f+4|0}return new ImageData(g,this.imageData.width,this.imageData.height)},e.prototype.__calculateColorCount=function(t){for(var e=new Map,o=t.length,r=0;r<o;){var a=248&t[r],n=248&t[r+1],i=248&t[r+2],l=a|n<<8|i<<16,s=e.get(l),c=s?s[3]+1:1;e.set(l,[a,n,i,c]),r=r+4|0}var h=[];return e.forEach((function(t){h[h.length]=t})),h},e.prototype.__getAverageColor=function(t){for(var e=0,o=0,r=0,a=0,n=0,i=t.length;n<i;n=n+1|0){var l=t[n],s=l[0],c=l[1],h=l[2],u=l[3];o=s*u+o,r=c*u+r,a=h*u+a,e=e+u|0}return[Math.round(o/e),Math.round(r/e),Math.round(a/e)]},e.prototype.__getTotalAnGreatestRangeChannel=function(e){for(var o=0,r=0,a=0,n=0,i=255,l=255,s=255,c=e.length,h=0;h<c;){var u=e[h],g=u[0],f=u[1],p=u[2],_=u[3];r=Math.max(g,r),a=Math.max(f,a),n=Math.max(p,n),i=Math.min(g,i),l=Math.min(f,l),s=Math.min(p,s),o+=_,h=h+1|0}var d=1.2*(r-i),v=1.2*(a-l),m=n-s,b=Math.max(d,v,m),M=t.R;return d===b&&(M=t.R),v===b&&(M=t.G),m===b&&(M=t.B),{total:o,channel:M}},e.prototype.__mediancut=function(t,e){var o=0,r=0;if(t.length+1>e)return t;for(var a=0,n=t.length;a<n;a=a+1|0)t[a].total>o&&1!==t[a].colors.length&&(r=a,o=t[a].total);var i=t[r];if(1===i.total||1===i.colors.length)return console.error("Cube could not be split."),t;var l=i.channel;i.colors.sort((function(t,e){return t[l]-e[l]}));var s=Math.floor((i.colors.length+1)/2),c=this.__generateBucket(i.colors.slice(0,s)),h=this.__generateBucket(i.colors.slice(s));return t.splice(r,1,c,h),this.__mediancut(t,e)},e.prototype.__generateBucket=function(t){var e=this.__getTotalAnGreatestRangeChannel(t);return{colors:t,total:e.total,channel:e.channel}},Object.defineProperties(e.prototype,o),e}));
