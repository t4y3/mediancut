{"version":3,"sources":["main.js"],"names":["window","addEventListener","canvas","document","querySelector","uploadElm","getElementById","uploadedElm","uploadArea","closeBtn","swapBtn","defaultImage","beforeImage","beforeImageSwap","colorSizeElm","cluster","Cluster","e","showPreviewArea","changeHandler","callback","image","preview","preventDefault","data","dataTransfer","files","resetPreview","swapImage","reduce","Number","target","value","classList","contains","remove","add","hidePreviewArea","run","src","restore","file","undefined","type","match","size","Image","fileReader","FileReader","onload","base64","result","readAsDataURL","__image","ctx","getContext","clearRect","width","height","drawImage","imagedata","getImageData","medianCut","MedianCut","putImageData"],"mappings":"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","file":"main.1f19ae8e.js","sourceRoot":"../demo/src","sourcesContent":["window.addEventListener(\"DOMContentLoaded\", () => {\n  const canvas = document.querySelector(\"#canvas\");\n  const uploadElm = document.getElementById(\"upload\");\n  const uploadedElm = document.getElementById(\"uploaded\");\n  const uploadArea = document.getElementById(\"upload-area\");\n  const closeBtn = document.querySelector(\"#close\");\n  const swapBtn = document.querySelector(\"#swap\");\n  const defaultImage = document.getElementById(\"original-image\");\n  const beforeImage = document.querySelector(\"#beforeImage\");\n  const beforeImageSwap = document.querySelector(\"#beforeImageSwap\");\n  const colorSizeElm = document.querySelector(\"#colorSize\");\n\n  const cluster = new Cluster({ canvas });\n\n  uploadArea.addEventListener(\"change\", (e) => {\n    showPreviewArea();\n    changeHandler({\n      e,\n      callback: (image) => {\n        preview(image);\n      },\n    });\n  });\n  uploadArea.addEventListener(\"dragenter\", (e) => {\n    e.preventDefault();\n  });\n  uploadArea.addEventListener(\"dragover\", (e) => {\n    e.preventDefault();\n  });\n  uploadArea.addEventListener(\"dragleave\", (e) => {\n    e.preventDefault();\n  });\n  uploadArea.addEventListener(\"drop\", (e) => {\n    e.preventDefault();\n    showPreviewArea();\n    changeHandler({\n      e,\n      data: e.dataTransfer.files[0],\n      callback: (image) => {\n        preview(image);\n      },\n    });\n  });\n\n  closeBtn.addEventListener(\"click\", () => {\n    resetPreview(beforeImage);\n  });\n\n  swapBtn.addEventListener(\"click\", () => {\n    swapImage();\n  });\n\n  colorSizeElm.addEventListener(\"change\", (e) => {\n    cluster.reduce(Number(e.target.value));\n  });\n\n  const swapImage = () => {\n    if (canvas.classList.contains(\"hidden\")) {\n      canvas.classList.remove(\"hidden\");\n      beforeImageSwap.classList.add(\"hidden\");\n    } else {\n      canvas.classList.add(\"hidden\");\n      beforeImageSwap.classList.remove(\"hidden\");\n    }\n  };\n\n  const showPreviewArea = () => {\n    uploadElm.classList.add(\"hidden\");\n    uploadedElm.classList.remove(\"hidden\");\n  };\n\n  const hidePreviewArea = () => {\n    uploadElm.classList.remove(\"hidden\");\n    uploadedElm.classList.add(\"hidden\");\n  };\n\n  const preview = (image) => {\n    cluster.run(image, 4);\n    beforeImage.src = image.src;\n    beforeImageSwap.src = image.src;\n    showPreviewArea();\n  };\n\n  const resetPreview = () => {\n    cluster.restore();\n    beforeImage.src = \"\";\n    beforeImageSwap.src = \"\";\n    hidePreviewArea();\n  };\n\n  showPreviewArea();\n  defaultImage.addEventListener(\"load\", (image) => {\n    preview(defaultImage);\n  });\n});\n\nconst changeHandler = ({ e, data, callback }) => {\n  // drag and dropの場合は e.dataTransfer.files[0] を使用\n  let file = data === undefined ? e.target.files[0] : data;\n\n  // 拡張子チェック\n  if (!file.type.match(/^image\\/(png|jpg|jpeg|gif)$/)) {\n    return;\n  }\n\n  // 容量チェック(5MB)\n  if (5 * 1024 * 1024 <= file.size) {\n    return;\n  }\n\n  let image = new Image();\n  let fileReader = new FileReader();\n\n  fileReader.onload = (e) => {\n    let base64 = e.target.result;\n\n    image.onload = () => {\n      callback(image);\n    };\n    image.src = base64;\n  };\n\n  fileReader.readAsDataURL(file);\n};\n\nexport default class Cluster {\n  constructor({ canvas }) {\n    this.canvas = canvas;\n    this.__image = null;\n  }\n\n  restore() {\n    const ctx = this.canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  run(image, size = 2) {\n    this.__image = image;\n    this.canvas.width = image.width;\n    this.canvas.height = image.height;\n    const ctx = this.canvas.getContext(\"2d\");\n    ctx.drawImage(\n      image,\n      0,\n      0,\n      image.width,\n      image.height,\n      0,\n      0,\n      image.width,\n      image.height\n    );\n\n    let imagedata = ctx.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n    let medianCut = new MedianCut(imagedata);\n    imagedata = medianCut.reduce(size);\n    ctx.putImageData(imagedata, 0, 0, 0, 0, imagedata.width, imagedata.height);\n  }\n\n  reduce(size = 2) {\n    const image = this.__image;\n    this.canvas.width = image.width;\n    this.canvas.height = image.height;\n    const ctx = this.canvas.getContext(\"2d\");\n    ctx.drawImage(\n      image,\n      0,\n      0,\n      image.width,\n      image.height,\n      0,\n      0,\n      image.width,\n      image.height\n    );\n\n    let imagedata = ctx.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n    let medianCut = new MedianCut(imagedata);\n    imagedata = medianCut.reduce(size);\n    ctx.putImageData(imagedata, 0, 0, 0, 0, imagedata.width, imagedata.height);\n  }\n}\n"]}