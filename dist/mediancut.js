!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.MedianCut=r()}(this,function(){"use strict";var t=function(t){this.raw=t.data,this.width=t.width,this.height=t.height,this.colors=this.getColorInfo(),this.cubes=[]};return t.prototype._setProperty=function(t){for(var r=0,o=0,e=0,s=0,h=255,n=255,i=255,a=0;a<t.length;a++){var l=t[a];o=Math.max(l.r,o),e=Math.max(l.g,e),s=Math.max(l.b,s),h=Math.min(l.r,h),n=Math.min(l.g,n),i=Math.min(l.b,i),r+=l.uses}var u=1.2*(o-h),c=1.2*(e-n),g=s-i,f="r";return u>c&&u>g&&(f="r"),c>u&&c>g&&(f="g"),g>u&&g>c&&(f="b"),{color:t,total:r,type:f}},t.prototype._mediancut=function(t,r){for(var o=0,e=0,s=0;s<t.length;s++)t[s].total>o&&1!=t[s].color.length&&(e=s,o=t[s].total);if(1==t[e].total)return console.error("Cube could not be split."),t;if(1==t[e].color.length)return console.error("Cube could not be split."),t;var h=t[e].type;t[e].color.sort(function(t,r){return t[h]<r[h]?-1:t[h]>r[h]?1:0});for(var n=Math.floor((t[e].color.length+1)/2),i=[],a=[],l=0;l<t[e].color.length;l++)l<n?i[i.length]=t[e].color[l]:a[a.length]=t[e].color[l];i=this._setProperty(i),a=this._setProperty(a);for(var u=[],c=0;c<t.length;c++)c!=e&&(u[u.length]=t[c]);return u[u.length]=i,u[u.length]=a,u.length<r?this._mediancut(u,r):u},t.prototype.getColorInfo=function(){for(var t=0,r={},o=0;o<this.height;o++)for(var e=0;e<this.width;e++){var s=this.raw[t]+","+this.raw[t+1]+","+this.raw[t+2];r[s]?r[s]+=1:r[s]=1,t+=4}var h,n=[];for(var i in r)h=i.split(","),n[n.length]={r:parseInt(h[0],10),g:parseInt(h[1],10),b:parseInt(h[2],10),uses:r[i]};return n},t.prototype.getColors=function(){for(var t=[],r=0;r<this.cubes.length;r++){for(var o=0,e=0,s=0,h=0,n=0;n<this.cubes[r].color.length;n++){var i=this.cubes[r].color[n];e+=i.r*i.uses,s+=i.g*i.uses,h+=i.b*i.uses,o+=i.uses}t[r]={r:Math.round(e/o),g:Math.round(s/o),b:Math.round(h/o)}}return t},t.prototype.run=function(t,r){this.colors.length<=t&&console.error("It has already been reduced color.");for(var o=[],e=0;e<this.colors.length;e++)o.push(this.colors[e]);var s=[];s[0]=this._setProperty(o),this.cubes=this._mediancut(s,t);for(var h=this.getColors(),n={},i=0;i<this.cubes.length;i++)for(var a=0;a<this.cubes[i].color.length;a++){var l=this.cubes[i].color[a];n[l.r+","+l.g+","+l.b]={r:h[i].r,g:h[i].g,b:h[i].b}}for(var u="",c=0,g=0;g<this.height;g++)for(var f=0;f<this.width;f++)u=this.raw[c]+","+this.raw[c+1]+","+this.raw[c+2],this.raw[c]=n[u].r,this.raw[c+1]=n[u].g,this.raw[c+2]=n[u].b,c+=4},t});
