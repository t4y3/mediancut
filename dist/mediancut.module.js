var t=function(t){var r=document.createElement("canvas").getContext("2d");this.imagedata=r.createImageData(t.width,t.height),this.imagedata.data.set(t.data),this.raw=this.imagedata.data,this.width=this.imagedata.width,this.height=this.imagedata.height,this.colors=this._getColorInfo(),this.cubes=[]};t.prototype._setProperty=function(t){for(var r=0,e=0,o=0,a=0,h=255,s=255,i=255,n=0;n<t.length;n++){var l=t[n];e=Math.max(l.r,e),o=Math.max(l.g,o),a=Math.max(l.b,a),h=Math.min(l.r,h),s=Math.min(l.g,s),i=Math.min(l.b,i),r+=l.uses}var g=1.2*(e-h),c=1.2*(o-s),u=a-i,d="r";return g>c&&g>u&&(d="r"),c>g&&c>u&&(d="g"),u>g&&u>c&&(d="b"),{color:t,total:r,type:d}},t.prototype._mediancut=function(t,r){for(var e=0,o=0,a=0;a<t.length;a++)t[a].total>e&&1!=t[a].color.length&&(o=a,e=t[a].total);if(1==t[o].total)return console.error("Cube could not be split."),t;if(1==t[o].color.length)return console.error("Cube could not be split."),t;var h=t[o].type;t[o].color.sort(function(t,r){return t[h]<r[h]?-1:t[h]>r[h]?1:0});for(var s=Math.floor((t[o].color.length+1)/2),i=[],n=[],l=0;l<t[o].color.length;l++)l<s?i[i.length]=t[o].color[l]:n[n.length]=t[o].color[l];i=this._setProperty(i),n=this._setProperty(n);for(var g=[],c=0;c<t.length;c++)c!=o&&(g[g.length]=t[c]);return g[g.length]=i,g[g.length]=n,g.length<r?this._mediancut(g,r):g},t.prototype._getColorInfo=function(){for(var t,r=0,e={},o=0;o<this.height;o++)for(var a=0;a<this.width;a++){var h=this.raw[r]+","+this.raw[r+1]+","+this.raw[r+2];e[h]?e[h]+=1:e[h]=1,r+=4}var s=[];for(var i in e)t=i.split(","),s[s.length]={r:parseInt(t[0],10),g:parseInt(t[1],10),b:parseInt(t[2],10),uses:e[i]};return s},t.prototype.getIndexColors=function(){for(var t=[],r=0;r<this.cubes.length;r++){for(var e=0,o=0,a=0,h=0,s=0;s<this.cubes[r].color.length;s++){var i=this.cubes[r].color[s];o+=i.r*i.uses,a+=i.g*i.uses,h+=i.b*i.uses,e+=i.uses}t[r]={r:Math.round(o/e),g:Math.round(a/e),b:Math.round(h/e)}}return t},t.prototype.run=function(t){this.colors.length<=t&&console.error("It has already been reduced color.");var r=[this._setProperty(this.colors)];this.cubes=this._mediancut(r,t);for(var e=this.getIndexColors(),o={},a=0;a<this.cubes.length;a++)for(var h=0;h<this.cubes[a].color.length;h++){var s=this.cubes[a].color[h];o[s.r+","+s.g+","+s.b]={r:e[a].r,g:e[a].g,b:e[a].b}}for(var i="",n=0,l=0;l<this.height;l++)for(var g=0;g<this.width;g++)i=this.raw[n]+","+this.raw[n+1]+","+this.raw[n+2],this.raw[n]=o[i].r,this.raw[n+1]=o[i].g,this.raw[n+2]=o[i].b,n+=4;return this.imagedata};export default t;
