var t=function(t){this.imageData=t,this.colors=this.__calculateColorCount(this.imageData.data),this.buckets=[]},e={palette:{configurable:!0}};e.palette.get=function(){for(var t=[],e=0,a=this.buckets.length;e<a;e=e+1|0)t[e]=this.__getAverageColor(this.buckets[e].color);return t},t.prototype.reduce=function(t){if(this.colors.length<=t)return console.warn("It has already been reduced color."),this.imageData;this.buckets=this.__mediancut([this.__generateBucket(this.colors)],t);for(var e=new Map,a=0,r=this.buckets.length;a<r;a=a+1|0)for(var o=this.buckets[a],n=this.__getAverageColor(o.colors),l=0,h=o.colors.length;l<h;l=l+1|0){var i=o.colors[l],c=248&i[0]|(248&i[1])<<8|(248&i[2])<<16;e.set(c,n)}for(var s=this.imageData.data,u=s.length,g=new Uint8ClampedArray(u),_=0;_<u;){var f=248&s[_]|(248&s[_+1])<<8|(248&s[_+2])<<16,v=e.get(f),p=v[0],m=v[1],d=v[2];g[_]=p,g[_+1]=m,g[_+2]=d,g[_+3]=s[_+3],_=_+4|0}return new ImageData(g,this.imageData.width,this.imageData.height)},t.prototype.__calculateColorCount=function(t){for(var e=new Map,a=t.length,r=0;r<a;){var o=248&t[r],n=248&t[r+1],l=248&t[r+2],h=o|n<<8|l<<16,i=e.get(h),c=i?i[3]+1:1;e.set(h,[o,n,l,c]),r=r+4|0}var s=[];return e.forEach(function(t){s[s.length]=t}),s},t.prototype.__getAverageColor=function(t){for(var e=0,a=0,r=0,o=0,n=0,l=t.length;n<l;n=n+1|0){var h=t[n],i=h[0],c=h[1],s=h[2],u=h[3];a=i*u+a,r=c*u+r,o=s*u+o,e=e+u|0}return[Math.round(a/e),Math.round(r/e),Math.round(o/e)]},t.prototype.__getTotalAnGreatestRangeChannel=function(t){for(var e=0,a=0,r=0,o=0,n=255,l=255,h=255,i=t.length,c=0;c<i;){var s=t[c],u=s[0],g=s[1],_=s[2],f=s[3];a=Math.max(u,a),r=Math.max(g,r),o=Math.max(_,o),n=Math.min(u,n),l=Math.min(g,l),h=Math.min(_,h),e+=f,c=c+1|0}var v=1.2*(a-n),p=1.2*(r-l),m=o-h,d=Math.max(v,p,m),M=0;return v===d&&(M=0),p===d&&(M=1),m===d&&(M=2),{total:e,channel:M}},t.prototype.__mediancut=function(t,e){var a=0,r=0;if(t.length+1>e)return t;for(var o=0,n=t.length;o<n;o=o+1|0)t[o].total>a&&1!==t[o].colors.length&&(r=o,a=t[o].total);var l=t[r];if(1===l.total||1===l.colors.length)return console.error("Cube could not be split."),t;var h=l.channel;l.colors.sort(function(t,e){return t[h]-e[h]});var i=Math.floor((l.colors.length+1)/2),c=this.__generateBucket(l.colors.slice(0,i)),s=this.__generateBucket(l.colors.slice(i));return t.splice(r,1,c,s),this.__mediancut(t,e)},t.prototype.__generateBucket=function(t){var e=this.__getTotalAnGreatestRangeChannel(t);return{colors:t,total:e.total,channel:e.channel}},Object.defineProperties(t.prototype,e);export default t;
